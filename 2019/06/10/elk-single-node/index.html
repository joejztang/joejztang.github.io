<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="migrating to raspberry server"><title>elk single node | 130L blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-118615339-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">elk single node</h1><a id="logo" href="/.">130L blog</a><p class="description">Cogito, ergo sum</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">elk single node</h1><div class="post-meta">2019-06-10</div><a class="disqus-comment-count" data-disqus-identifier="2019/06/10/elk-single-node/" href="/2019/06/10/elk-single-node/#disqus_thread"></a><div class="post-content"><h2 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h2><ul>
<li>os: ubuntu 14.04</li>
<li>elasticsearch: 2.2.x</li>
<li>logstash: 2.2.x</li>
<li>kibana: 4.5.x</li>
</ul>
<p>what does it like for ELK stack</p>
<p><img src="/images/elk.png" alt="elk"></p>
<ul>
<li>client servers installed with filebeat sends logs to elk server</li>
<li>elk/logstash server process and index log, store logs, search and visualize and using nginx to do reverse proxy</li>
</ul>
<h2 id="installations"><a href="#installations" class="headerlink" title="installations"></a>installations</h2><h3 id="install-java-8"><a href="#install-java-8" class="headerlink" title="install java 8"></a>install java 8</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository -y ppa:webupd8team/java</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -y install oracle-java8-installer</span><br></pre></td></tr></table></figure>

<h3 id="install-elasticsearch"><a href="#install-elasticsearch" class="headerlink" title="install elasticsearch"></a>install elasticsearch</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb http://packages.elastic.co/elasticsearch/2.x/debian stable main&quot;</span> | sudo tee -a /etc/apt/sources.list.d/elasticsearch-2.x.list</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install -y elasticsearch</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>elasticsearch is installed, now configurations.</p>
<p><code>sudo vim /etc/elasticsearch/elasticsearch.yml</code></p>
<p>this is where to configure elasticsearch. we care about who can access elasticsearch. in order to keep it safe, we only allow <code>localhost</code> to access elasticsearch so that outsider cannot access elasticsearch instance, hence the data.</p>
<p>to do this, find <code>network.host</code> keyword, uncomment the line:</p>
<figure class="highlight vim"><figcaption><span>elasticsearch.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  network.hos<span class="variable">t:</span> localhost</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>save and exit</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo service elasticsearch restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># start elasticsearch when boot up and priority of starting and killing</span></span><br><span class="line">sudo update-rc.d elasticsearch defaults 95 10</span><br><span class="line">``</span><br><span class="line"></span><br><span class="line"><span class="comment">### install kibana</span></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb http://packages.elastic.co/kibana/4.5/debian stable main&quot;</span> | sudo tee -a /etc/apt/sources.list.d/kibana-4.5.x.list</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -y install kibana</span><br></pre></td></tr></table></figure>

<p>next, like elasticsearch, we need to configure kibana</p>
<p>open config file</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /opt/kibana/config/kibana.yml</span><br></pre></td></tr></table></figure>

<p>find <code>server.host</code> keyword and replace <code>0.0.0.0</code> into <code>localhost</code></p>
<figure class="highlight vim"><figcaption><span>kibana.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.hos<span class="variable">t:</span> <span class="string">&quot;localhost&quot;</span></span><br></pre></td></tr></table></figure>

<p>save and exit</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo update-rc.d kibana defaults 96 9</span><br><span class="line">sudo service kibana start</span><br></pre></td></tr></table></figure>

<h3 id="install-nginx"><a href="#install-nginx" class="headerlink" title="install nginx"></a>install nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nginx apache2-utils</span><br><span class="line"></span><br><span class="line"><span class="comment"># create admin user named &quot;kibanaadmin&quot;, that can access kibana web interface</span></span><br><span class="line">sudo htpasswd -c /etc/nginx/htpasswd.users kibanaadmin</span><br></pre></td></tr></table></figure>

<p>now configure nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/default</span><br></pre></td></tr></table></figure>

<figure class="highlight vim"><figcaption><span>/etc/nginx/sites-available/default</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line"></span><br><span class="line">    server_name localhost;</span><br><span class="line"></span><br><span class="line">    auth_basic &quot;Restricted Access&quot;;</span><br><span class="line">    auth_basic_user_file /etc/nginx/htpasswd.users;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://localhost:5601;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection &#x27;upgrade&#x27;;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_cache_bypass $http_upgrade;        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><em>optional</em>: in case you meet <code>fail to bind</code> error, please follow <a target="_blank" rel="noopener" href="https://joejztang.github.io/2019/06/06/nginx-bind-to-fails/">this</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx restart</span><br></pre></td></tr></table></figure>

<p>now if you go to localhost, then you will see kibana welcome page.</p>
<h3 id="install-logstash"><a href="#install-logstash" class="headerlink" title="install logstash"></a>install logstash</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;deb http://packages.elastic.co/logstash/2.2/debian stable main&#x27;</span> | sudo tee /etc/apt/sources.list.d/logstash-2.2.x.list</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install logstash</span><br></pre></td></tr></table></figure>

<h3 id="generating-SSL-certificates"><a href="#generating-SSL-certificates" class="headerlink" title="generating SSL certificates"></a>generating SSL certificates</h3><blockquote>
<p>Since we are going to use Filebeat to ship logs from our Client Servers to our ELK Server, we need to create an SSL certificate and key pair. The certificate is used by Filebeat to verify the identity of ELK Server. Create the directories that will store the certificate and private key with the following commands:</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/pki/tls/certs</span><br><span class="line">sudo mkdir /etc/pki/tls/private</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Now you have two options for generating your SSL certificates. If you have a DNS setup that will allow your client servers to resolve the IP address of the ELK Server, use Option 2. Otherwise, Option 1 will allow you to use IP addresses.</p>
</blockquote>
<p><strong>this post will only introduce option 1, that is using ip address</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/ssl/openssl.cnf</span><br></pre></td></tr></table></figure>

<p>find <code>[v3_ca]</code> section and add one line below</p>
<figure class="highlight vim"><figcaption><span>/etc/ssl/openssl.cnf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">subjectAltName = IP: ELK_server_private_IP</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>save and exit</p>
<p><strong>hint:</strong> how to find elk server private ip address</p>
<p><code>ifconfig eth0 | grep &quot;inet addr:&quot; | cut -d &quot;:&quot; -f2 | cut -d &quot; &quot; -f1</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># generate ssl certificate in appropriate locations (/etc/pki/tls/)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /etc/pki/tls</span><br><span class="line">sudo openssl req -config /etc/ssl/openssl.cnf -x509 -days 3650 -batch -nodes -newkey rsa:2048 -keyout private/logstash-forwarder.key -out certs/logstash-forwarder.crt</span><br></pre></td></tr></table></figure>

<h3 id="configure-logstash"><a href="#configure-logstash" class="headerlink" title="configure logstash"></a>configure logstash</h3><blockquote>
<p>Logstash configuration files are in the JSON-format, and reside in /etc/logstash/conf.d. The configuration consists of three sections: <strong>inputs, filters, and outputs</strong>.</p>
</blockquote>
<p>create input conf by </p>
<p><code>sudo vim /etc/logstash/conf.d/02-beats-input.conf</code></p>
<figure class="highlight vim"><figcaption><span>/etc/logstash/conf.d/02-beats-input.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">input</span> &#123;</span><br><span class="line">  beats &#123;</span><br><span class="line">    port =&gt; <span class="number">5044</span></span><br><span class="line">    ssl =&gt; true</span><br><span class="line">    ssl_certificate =&gt; <span class="string">&quot;/etc/pki/tls/certs/logstash-forwarder.crt&quot;</span></span><br><span class="line">    ssl_key =&gt; <span class="string">&quot;/etc/pki/tls/private/logstash-forwarder.key&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>create filter conf by</p>
<p><code>sudo vim /etc/logstash/conf.d/10-syslog-filter.conf</code></p>
<figure class="highlight vim"><figcaption><span>/etc/logstash/conf.d/10-syslog-filter.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">filter</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">&quot;syslog&quot;</span> &#123;</span><br><span class="line">    grok &#123;</span><br><span class="line">      <span class="keyword">match</span> =&gt; &#123; <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;%&#123;SYSLOGTIMESTAMP:syslog_timestamp&#125; %&#123;SYSLOGHOST:syslog_hostname&#125; %&#123;DATA:syslog_program&#125;(?:\[%&#123;POSINT:syslog_pid&#125;\])?: %&#123;GREEDYDATA:syslog_message&#125;&quot;</span> &#125;</span><br><span class="line">      add_field =&gt; [ <span class="string">&quot;received_at&quot;</span>, <span class="string">&quot;%&#123;@timestamp&#125;&quot;</span> ]</span><br><span class="line">      add_field =&gt; [ <span class="string">&quot;received_from&quot;</span>, <span class="string">&quot;%&#123;host&#125;&quot;</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">    syslog_pri &#123; &#125;</span><br><span class="line">    date &#123;</span><br><span class="line">      <span class="keyword">match</span> =&gt; [ <span class="string">&quot;syslog_timestamp&quot;</span>, <span class="string">&quot;MMM  d HH:mm:ss&quot;</span>, <span class="string">&quot;MMM dd HH:mm:ss&quot;</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>create output conf by</p>
<p><code>sudo vim /etc/logstash/conf.d/30-elasticsearch-output.conf</code></p>
<figure class="highlight vim"><figcaption><span>/etc/logstash/conf.d/30-elasticsearch-output.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    hosts =&gt; [<span class="string">&quot;localhost:9200&quot;</span>]</span><br><span class="line">    sniffing =&gt; true</span><br><span class="line">    manage_template =&gt; false</span><br><span class="line">    <span class="built_in">index</span> =&gt; <span class="string">&quot;%&#123;[@metadata][beat]&#125;-%&#123;+YYYY.MM.dd&#125;&quot;</span></span><br><span class="line">    document_type =&gt; <span class="string">&quot;%&#123;[@metadata][type]&#125;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>the way to check logstash configuration is </p>
<p><code>sudo service logstash configtest</code></p>
<p>if you see <code>Configuration OK</code>, it means there is no syntax error</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo service logstash restart</span><br><span class="line">sudo update-rc.d logstash defaults 96 9</span><br></pre></td></tr></table></figure>

<h3 id="optional-load-kibana-dashboards"><a href="#optional-load-kibana-dashboards" class="headerlink" title="(optional) load kibana dashboards"></a><em>(optional)</em> load kibana dashboards</h3><blockquote>
<p>Elastic provides several sample Kibana dashboards and Beats index patterns that can help you get started with Kibana</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">curl -L -O https://download.elastic.co/beats/dashboards/beats-dashboards-1.1.0.zip</span><br><span class="line">sudo apt-get -y install unzip</span><br><span class="line">unzip beats-dashboards-*.zip</span><br><span class="line"><span class="built_in">cd</span> beats-dashboards-*</span><br><span class="line">./load.sh</span><br></pre></td></tr></table></figure>

<p>we can see some index pattern we just loaded</p>
<ul>
<li>[packetbeat-]YYYY.MM.DD</li>
<li>[topbeat-]YYYY.MM.DD</li>
<li>[filebeat-]YYYY.MM.DD</li>
<li>[winlogbeat-]YYYY.MM.DD</li>
</ul>
<h3 id="optional-load-filebeat-index-template-in-elasticsearch"><a href="#optional-load-filebeat-index-template-in-elasticsearch" class="headerlink" title="(optional) load filebeat index template in elasticsearch"></a><em>(optional)</em> load filebeat index template in elasticsearch</h3><h3 id="optional-copy-elk-cert-to-client-server"><a href="#optional-copy-elk-cert-to-client-server" class="headerlink" title="(optional) copy elk cert to client server"></a><em>(optional)</em> copy elk cert to client server</h3><p>copy elk cert to client server in order to establish communication. because our model is single node, this is not mandatory.</p>
<h3 id="install-filebeat-on-client-server"><a href="#install-filebeat-on-client-server" class="headerlink" title="install filebeat on client server"></a>install filebeat on client server</h3><p><strong>notice that it must happen at client server</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb https://packages.elastic.co/beats/apt stable main&quot;</span> |  sudo tee -a /etc/apt/sources.list.d/beats.list</span><br><span class="line">wget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install filebeat</span><br></pre></td></tr></table></figure>

<p>next we configure filebeat</p>
<p><code>sudo vim /etc/filebeat/filebeat.yml</code></p>
<p>near top of the file, we will find <code>prospectors</code> section. what we do following is to send only <code>syslog</code> and <code>auth.log</code> to logstash</p>
<p>we do the following</p>
<figure class="highlight vim"><figcaption><span>/etc/filebeat/filebeat.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">      path<span class="variable">s:</span></span><br><span class="line">        - /var/<span class="built_in">log</span>/auth.<span class="built_in">log</span></span><br><span class="line">        - /var/<span class="built_in">log</span>/syslog</span><br><span class="line">#        - /var/<span class="built_in">log</span>/*.<span class="built_in">log</span></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">      document_type: syslog</span><br><span class="line">...</span><br><span class="line">### Logstash <span class="keyword">as</span> output</span><br><span class="line">  logstash:</span><br><span class="line">    # The Logstash hosts</span><br><span class="line">    host<span class="variable">s:</span> [<span class="string">&quot;ELK_server_private_IP:5044&quot;</span>]</span><br><span class="line"># directly under hosts section we <span class="built_in">add</span></span><br><span class="line">    bulk_max_size: <span class="number">1024</span></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">tl</span><span class="variable">s:</span></span><br><span class="line">      # List of root certificates <span class="keyword">for</span> HTTPS server verifications</span><br><span class="line">      certificate_authoritie<span class="variable">s:</span> [<span class="string">&quot;/etc/pki/tls/certs/logstash-forwarder.crt&quot;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>save and exit</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo service filebeat restart</span><br><span class="line">sudo update-rc.d filebeat defaults 95 10</span><br></pre></td></tr></table></figure>

<h2 id="test-filebeat-installation"><a href="#test-filebeat-installation" class="headerlink" title="test filebeat installation"></a>test filebeat installation</h2><p>on <strong>elk server</strong>, we verify if we receive data by searching filebeat.</p>
<p><code>curl -XGET &#39;http://localhost:9200/filebeat-*/_search?pretty&#39;</code></p>
<blockquote>
<p>If your output shows <strong>0</strong> total hits, Elasticsearch is not loading any logs under the index you searched for, and you should review your setup for errors.</p>
</blockquote>
<h2 id="go-to-kibana-dashboard"><a href="#go-to-kibana-dashboard" class="headerlink" title="go to kibana dashboard"></a>go to kibana dashboard</h2><p>if the first time you go to kibana dashboard, it asked you to select a default index pattern. after your selection, and <strong>star</strong> it, go to <code>Discover</code>, and you find your log.</p>
<h2 id="credit-to"><a href="#credit-to" class="headerlink" title="credit to"></a>credit to</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-elasticsearch-logstash-and-kibana-elk-stack-on-ubuntu-14-04">elk on ubuntu</a></li>
<li><a target="_blank" rel="noopener" href="https://anandprakashtandale.wordpress.com/2016/06/28/elk-elastic-search-logstash-kibanastack-installation-script/">elk installation script</a></li>
</ul>
</div><div class="tags"><a href="/tags/elk/"><i class="fa fa-tag"></i>elk</a></div><div class="post-nav"><a class="pre" href="/2019/06/14/attempted-relative-import-with-no-parent-package/">attemped-relative-import-with-no-parent-package</a><a class="next" href="/2019/06/06/python-unittest-mock/">python-unittest-mock</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://example.com/2019/06/10/elk-single-node/';
    this.page.identifier = '2019/06/10/elk-single-node/';
    this.page.title = 'elk single node';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//joejztang.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//joejztang.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://joejztang.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/alg-summary/">Alg summary</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/alison-photography/">Alison photography</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">C#</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/dp/">DP</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/django/">Django</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">Hexo</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">Java</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/math/">Math</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/math/linear-algebra/">Linear Algebra</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/r/">R</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/sql-server/">SQL Server</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/scrapy/">Scrapy</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/selfnotes/">SelfNotes</a><span class="category-list-count">30</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unit-test/">Unit Test</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/apache-beam/">apache beam</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/big-data/">big data</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cheat-sheet/">cheat sheet</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/">css</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/data-structure/">data structure</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/deep-learning/">deep learning</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/elasticsearch/">elasticsearch</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/flask/">flask</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/graph/">graph</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/jenkins/">jenkins</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/language-common/">language common</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linear-algebra/">linear algebra</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/machine-learning/">machine learning</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nodejs/">nodejs</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/pandas/">pandas</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/photoshop/">photoshop</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/reactjs/">reactjs</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/server/">server</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spark/">spark</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/recommender-system/" style="font-size: 15px;">recommender system</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/https/" style="font-size: 15px;">https</a> <a href="/tags/cheat-sheet/" style="font-size: 15px;">cheat sheet</a> <a href="/tags/logging/" style="font-size: 15px;">logging</a> <a href="/tags/conda/" style="font-size: 15px;">conda</a> <a href="/tags/venv/" style="font-size: 15px;">venv</a> <a href="/tags/unittest/" style="font-size: 15px;">unittest</a> <a href="/tags/cheating-sheet/" style="font-size: 15px;">cheating sheet</a> <a href="/tags/recursion/" style="font-size: 15px;">recursion</a> <a href="/tags/cte/" style="font-size: 15px;">CTE</a> <a href="/tags/sql-server/" style="font-size: 15px;">SQL Server</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/keras/" style="font-size: 15px;">keras</a> <a href="/tags/tensorflow/" style="font-size: 15px;">tensorflow</a> <a href="/tags/elk/" style="font-size: 15px;">elk</a> <a href="/tags/google-cloud/" style="font-size: 15px;">google cloud</a> <a href="/tags/graph-theory/" style="font-size: 15px;">graph theory</a> <a href="/tags/hexo-404-issue/" style="font-size: 15px;">hexo 404 issue</a> <a href="/tags/seo/" style="font-size: 15px;">seo</a> <a href="/tags/hexo-%E4%BC%98%E5%8C%96/" style="font-size: 15px;">hexo 优化</a> <a href="/tags/kubernetes/" style="font-size: 15px;">kubernetes</a> <a href="/tags/java-io/" style="font-size: 15px;">Java IO</a> <a href="/tags/java-8-streams/" style="font-size: 15px;">java 8 streams</a> <a href="/tags/java-lambda/" style="font-size: 15px;">java lambda</a> <a href="/tags/alg/" style="font-size: 15px;">alg</a> <a href="/tags/binary-search/" style="font-size: 15px;">binary search</a> <a href="/tags/pandas/" style="font-size: 15px;">pandas</a> <a href="/tags/photography/" style="font-size: 15px;">photography</a> <a href="/tags/php-tools/" style="font-size: 15px;">php tools</a> <a href="/tags/debug-trick/" style="font-size: 15px;">debug trick</a> <a href="/tags/amazon/" style="font-size: 15px;">amazon</a> <a href="/tags/heapq/" style="font-size: 15px;">heapq</a> <a href="/tags/circular-imports/" style="font-size: 15px;">circular imports</a> <a href="/tags/mock/" style="font-size: 15px;">mock</a> <a href="/tags/pytest/" style="font-size: 15px;">pytest</a> <a href="/tags/react-redux/" style="font-size: 15px;">react-redux</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/react/" style="font-size: 15px;">react</a> <a href="/tags/apache/" style="font-size: 15px;">apache</a> <a href="/tags/redux/" style="font-size: 15px;">redux</a> <a href="/tags/regular-expression/" style="font-size: 15px;">regular expression</a> <a href="/tags/python3/" style="font-size: 15px;">python3</a> <a href="/tags/template/" style="font-size: 15px;">template</a> <a href="/tags/java-8-io/" style="font-size: 15px;">Java 8 IO</a> <a href="/tags/idea/" style="font-size: 15px;">idea</a> <a href="/tags/whim/" style="font-size: 15px;">whim</a> <a href="/tags/hexo-math-equations/" style="font-size: 15px;">hexo math equations</a> <a href="/tags/jenkins/" style="font-size: 15px;">jenkins</a> <a href="/tags/tag/" style="font-size: 15px;">tag</a> <a href="/tags/fb/" style="font-size: 15px;">fb</a> <a href="/tags/dp/" style="font-size: 15px;">dp</a> <a href="/tags/ood/" style="font-size: 15px;">ood</a> <a href="/tags/epic/" style="font-size: 15px;">Epic</a> <a href="/tags/sql/" style="font-size: 15px;">sql</a> <a href="/tags/frequent/" style="font-size: 15px;">frequent</a> <a href="/tags/backtracking/" style="font-size: 15px;">backtracking</a> <a href="/tags/inversion-count/" style="font-size: 15px;">inversion count</a> <a href="/tags/code/" style="font-size: 15px;">code</a> <a href="/tags/tbd/" style="font-size: 15px;">tbd</a> <a href="/tags/google/" style="font-size: 15px;">google</a> <a href="/tags/linkedlist/" style="font-size: 15px;">linkedlist</a> <a href="/tags/sliding-window/" style="font-size: 15px;">sliding window</a> <a href="/tags/tree/" style="font-size: 15px;">tree</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91/" style="font-size: 15px;">面试高频</a> <a href="/tags/bfs/" style="font-size: 15px;">BFS</a> <a href="/tags/dfs/" style="font-size: 15px;">DFS</a> <a href="/tags/two-pointer/" style="font-size: 15px;">two pointer</a> <a href="/tags/rabin-karp/" style="font-size: 15px;">rabin-karp</a> <a href="/tags/graph/" style="font-size: 15px;">graph</a> <a href="/tags/stack/" style="font-size: 15px;">stack</a> <a href="/tags/bst/" style="font-size: 15px;">BST</a> <a href="/tags/twitter/" style="font-size: 15px;">twitter</a> <a href="/tags/iterative/" style="font-size: 15px;">iterative</a> <a href="/tags/two-pointers/" style="font-size: 15px;">two pointers</a> <a href="/tags/ood/" style="font-size: 15px;">OOD</a> <a href="/tags/io/" style="font-size: 15px;">io</a> <a href="/tags/object-oriented-design/" style="font-size: 15px;">Object Oriented Design</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/04/25/code/2130-Maximum-Twin-Sum-of-a-Linked-List/">2130. Maximum Twin Sum of a Linked List</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/25/code/1856-Maximum-Subarray-MinProduct/">1856. Maximum Subarray Min-Product</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/23/code/703-Kth-Largest-Element-in-a-Stream/">703. Kth Largest Element in a Stream</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/23/code/1091-Shortest-Path-in-Binary-Matrix/">1091. Shortest Path in Binary Matrix</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/19/code/926-Flip-String-to-Monotone-Increasing/">926. Flip String to Monotone Increasing</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/19/code/1567-Maximum-Length-of-Subarray-With-Positive-Product/">1567. Maximum Length of Subarray With Positive Product</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/19/code/2104-Sum-of-Subarray-Ranges/">2104. Sum of Subarray Ranges</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/18/code/907-Sum-of-Subarray-Minimums/">907. Sum of Subarray Minimums</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/18/code/937-Reorder-Data-in-Log-Files/">937. Reorder Data in Log Files</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/04/17/code/1197-Minimum-Knight-Moves/">1197. Minimum Knight Moves</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> Recent Comments</i></div><script type="text/javascript" src="//joejztang.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">130L blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=0.0.0"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>