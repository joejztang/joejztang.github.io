<!doctype html><html lang=en><head><title>python circular imports · 130l</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="130l"><meta name=description content="
  many ways to import a module
  
    
    Link to heading
  


  import X
  
    
    Link to heading
  

imports module X, and creates a reference to module in current namespace.

  from X import a, b, c
  
    
    Link to heading
  

imports module X and creates references in the current namespace to given objects, in this case a, b, c.

  what does python do to import module
  
    
    Link to heading
  

if module has already registered (sys.modules), it just passes."><meta name=keywords content="blog,science,technology,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="python circular imports"><meta name=twitter:description content="many ways to import a module Link to heading import X Link to heading imports module X, and creates a reference to module in current namespace.
from X import a, b, c Link to heading imports module X and creates references in the current namespace to given objects, in this case a, b, c.
what does python do to import module Link to heading if module has already registered (sys.modules), it just passes."><meta property="og:url" content="https://joejztang.github.io/posts/python-circular-imports/"><meta property="og:site_name" content="130l"><meta property="og:title" content="python circular imports"><meta property="og:description" content="many ways to import a module Link to heading import X Link to heading imports module X, and creates a reference to module in current namespace.
from X import a, b, c Link to heading imports module X and creates references in the current namespace to given objects, in this case a, b, c.
what does python do to import module Link to heading if module has already registered (sys.modules), it just passes."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-03-29T11:47:27+00:00"><meta property="article:modified_time" content="2018-03-29T11:47:27+00:00"><meta property="article:tag" content="Circular Imports"><meta property="article:tag" content="Python"><link rel=canonical href=https://joejztang.github.io/posts/python-circular-imports/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.4b392a85107b91dbdabc528edf014a6ab1a30cd44cafcd5325c8efe796794fca.css integrity="sha256-SzkqhRB7kdvavFKO3wFKarGjDNRMr81TJcjv55Z5T8o=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/img/favicon.svg sizes=any><link rel=icon type=image/png href=/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/img/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://joejztang.github.io/>130l
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Posts</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://joejztang.github.io/posts/python-circular-imports/>python circular imports</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2018-03-29T11:47:27Z>March 29, 2018
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
3-minute read</span></div><div class=categories><i class="fa-solid fa-folder" aria-hidden=true></i>
<a href=/categories/flask/>Flask</a></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/circular-imports/>Circular Imports</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/python/>Python</a></span></div></div></header><div class=post-content><h3 id=many-ways-to-import-a-module>many ways to import a module
<a class=heading-link href=#many-ways-to-import-a-module><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><h4 id=import-x><code>import X</code>
<a class=heading-link href=#import-x><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>imports module X, and creates a reference to module in current namespace.</p><h4 id=from-x-import-a-b-c><code>from X import a, b, c</code>
<a class=heading-link href=#from-x-import-a-b-c><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>imports module X and creates references in the current namespace to given objects, in this case a, b, c.</p><h3 id=what-does-python-do-to-import-module>what does python do to import module
<a class=heading-link href=#what-does-python-do-to-import-module><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>if module has already registered (sys.modules), it just passes.</p><p>else,</p><ul><li>create new module object in dict</li><li>load module object</li><li>execute the module code in the new module&rsquo;s namespace</li></ul><h3 id=what-is-a-circular-dependency>what is a circular dependency
<a class=heading-link href=#what-is-a-circular-dependency><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>two or more modules depend on each other. For example:</p><pre tabindex=0><code>functionA():
	functionB()
	
functionB():
	functionA()
</code></pre><pre tabindex=0><code>	---------------
	|				 |
	v				 |
functionA		  functionB
	|				 ^	
	|				 |
	---------------
</code></pre><h3 id=cons>Cons
<a class=heading-link href=#cons><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><ul><li><p>tight coupling between modules, so that reduced code reusability</p></li><li><p>source of potential failures, such as infinite recursions, memory leaks and cascade effects.</p></li><li><p>very difficult to debug and very hard to realize it is something related to circular imports.</p></li></ul><h3 id=what-is-a-circular-import>what is a circular import
<a class=heading-link href=#what-is-a-circular-import><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>see below three python files</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic>#__init__.py</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>module1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>module1<span style=color:#ff7b72;font-weight:700>.</span>function1()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic>#module1.py</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>module2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>function1</span>():
</span></span><span style=display:flex><span>	module2<span style=color:#ff7b72;font-weight:700>.</span>function2()
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>function3</span>():
</span></span><span style=display:flex><span>	print(<span style=color:#a5d6ff>&#39;Goodbye, World!&#39;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic>#module2.py</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>module1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>function2</span>():
</span></span><span style=display:flex><span>	print(<span style=color:#a5d6ff>&#39;Hello, World!&#39;</span>)
</span></span><span style=display:flex><span>	module1<span style=color:#ff7b72;font-weight:700>.</span>function3()
</span></span></code></pre></div><p>executing:</p><pre tabindex=0><code>$ python __init__.py
Hello, World!  
Traceback (most recent call last):  
  File &#34;__init__.py&#34;, line 3, in &lt;module&gt;
    module1.function1()
  File &#34;/Users/scott/projects/sandbox/python/circular-dep-test/module1/__init__.py&#34;, line 5, in function1
    module2.function2()
  File &#34;/Users/scott/projects/sandbox/python/circular-dep-test/module2/__init__.py&#34;, line 6, in function2
    module1.function3()
AttributeError: &#39;module&#39; object has no attribute &#39;function3&#39;  
</code></pre><p>When Python imports a module, it checks the module registry to see if the module was already imported. If the module was already registered, Python uses that existing object from cache. The module registry is a table of modules that have been initialized and indexed by module name. This table can be accessed through <code>sys.modules</code>.</p><p>If it was not registered, Python finds the module, initializes it if necessary, and executes it in the new module&rsquo;s namespace.</p><p>Modules are executed during import, and new functions and classes won’t appear in the module’s namespace until the def (or class) statement has been executed.</p><p>in this case, let&rsquo;s analyze it.</p><p><code>__init__.py</code> import module 1, so <code>sys.modules</code> contains module 1(empty). module 1 imports module2, so <code>sys.modules</code> contains module 2 (empty). next <code>def</code> will be executed, it calls module1.function3(). But notes that module 1 is empty right now in dict.</p><h3 id=how-to-fix-circular-dependenciesimports>How to fix circular dependencies/imports
<a class=heading-link href=#how-to-fix-circular-dependenciesimports><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>Simple solution, not for flask or anyother framework:</p><ul><li>merge modules together to a larger module.</li></ul><p>However, merged module may have unrelated functions, this is called tight coupling.</p><ul><li>Another solution is to import only needed. The above file can be rewritten as</li></ul><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># module 1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>function1</span>():  
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>module2</span>
</span></span><span style=display:flex><span>    module2<span style=color:#ff7b72;font-weight:700>.</span>function2()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>def</span> <span style=color:#d2a8ff;font-weight:700>function3</span>():  
</span></span><span style=display:flex><span>    print(<span style=color:#a5d6ff>&#39;Goodbye, World!&#39;</span>)
</span></span></code></pre></div><ul><li>in flask, people tend to import at last to avoid circular imports</li></ul></div><footer><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme"),themeInParams="github-light";getTheme==null&&(themeInParams!==""&&themeInParams!=="auto"?getTheme=themeInParams:getTheme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");let theme=getTheme==="dark"?"github-dark":"github-light",s=document.createElement("script");s.src="https://utteranc.es/client.js",s.setAttribute("repo","joejztang/joejztang.github.io"),s.setAttribute("issue-term","pathname"),s.setAttribute("theme",theme),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article></section></div><footer class=footer><section class=container>©
1990 -
2025
130l
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YNPYVVT1S7"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YNPYVVT1S7")}</script></body></html>