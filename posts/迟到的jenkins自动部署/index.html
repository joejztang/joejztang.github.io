<!doctype html><html lang=en><head><title>迟到的jenkins自动部署 · 130l</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="130l"><meta name=description content="用了hexo很久， 最近想要不止在自己的电脑上写博客， 每个电脑都能写。 然而hexo不支持， 所以想到了用jenkins配hexo。 当然jenkins可不是专门干这个的， jenkins可还有大用处。 我自己配置的时候遇见了很多坑， 如果遇见了一样的， 可以参考这篇帖子。 希望给你帮助。

  hexo配置
  
    
    Link to heading
  

由于我不太想要把自己的帖子source都暴露在网上， 所以我用了一个private repo。所有就有了如下的配置图

  配置图
  
    
    Link to heading
  


hexo/source >------
            commit|
                  |------> jenkins
                    -----< hook && logic
                   |
                   |
hexo/public <-------
             update

  jenkins配置
  
    
    Link to heading
  

我把jenkins放在了aws上面。 之前很久就想要用ec2， 但是总是没有机会。 通过这次机会， 一并用了。我参考了这个文件
当然， 折腾也开始了。

  host name is not ec2-user
  
    
    Link to heading
  

不要用ssh去ec2-user@xxxxxx.amazon.com， amazon不会创建ec2-user给你，用要用ubuntu。"><meta name=keywords content="blog,science,technology,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="迟到的jenkins自动部署"><meta name=twitter:description content="用了hexo很久， 最近想要不止在自己的电脑上写博客， 每个电脑都能写。 然而hexo不支持， 所以想到了用jenkins配hexo。 当然jenkins可不是专门干这个的， jenkins可还有大用处。 我自己配置的时候遇见了很多坑， 如果遇见了一样的， 可以参考这篇帖子。 希望给你帮助。
hexo配置 Link to heading 由于我不太想要把自己的帖子source都暴露在网上， 所以我用了一个private repo。所有就有了如下的配置图
配置图 Link to heading hexo/source >------ commit| |------> jenkins -----< hook && logic | | hexo/public <------- update jenkins配置 Link to heading 我把jenkins放在了aws上面。 之前很久就想要用ec2， 但是总是没有机会。 通过这次机会， 一并用了。我参考了这个文件 当然， 折腾也开始了。
host name is not ec2-user Link to heading 不要用ssh去ec2-user@xxxxxx.amazon.com， amazon不会创建ec2-user给你，用要用ubuntu。"><meta property="og:url" content="https://joejztang.github.io/posts/%E8%BF%9F%E5%88%B0%E7%9A%84jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/"><meta property="og:site_name" content="130l"><meta property="og:title" content="迟到的jenkins自动部署"><meta property="og:description" content="用了hexo很久， 最近想要不止在自己的电脑上写博客， 每个电脑都能写。 然而hexo不支持， 所以想到了用jenkins配hexo。 当然jenkins可不是专门干这个的， jenkins可还有大用处。 我自己配置的时候遇见了很多坑， 如果遇见了一样的， 可以参考这篇帖子。 希望给你帮助。
hexo配置 Link to heading 由于我不太想要把自己的帖子source都暴露在网上， 所以我用了一个private repo。所有就有了如下的配置图
配置图 Link to heading hexo/source >------ commit| |------> jenkins -----< hook && logic | | hexo/public <------- update jenkins配置 Link to heading 我把jenkins放在了aws上面。 之前很久就想要用ec2， 但是总是没有机会。 通过这次机会， 一并用了。我参考了这个文件 当然， 折腾也开始了。
host name is not ec2-user Link to heading 不要用ssh去ec2-user@xxxxxx.amazon.com， amazon不会创建ec2-user给你，用要用ubuntu。"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-02-22T14:12:26+00:00"><meta property="article:modified_time" content="2019-02-22T14:12:26+00:00"><meta property="article:tag" content="Jenkins"><link rel=canonical href=https://joejztang.github.io/posts/%E8%BF%9F%E5%88%B0%E7%9A%84jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.4b392a85107b91dbdabc528edf014a6ab1a30cd44cafcd5325c8efe796794fca.css integrity="sha256-SzkqhRB7kdvavFKO3wFKarGjDNRMr81TJcjv55Z5T8o=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/img/favicon.svg sizes=any><link rel=icon type=image/png href=/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/img/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://joejztang.github.io/>130l
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Posts</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://joejztang.github.io/posts/%E8%BF%9F%E5%88%B0%E7%9A%84jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/>迟到的jenkins自动部署</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2019-02-22T14:12:26Z>February 22, 2019
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
2-minute read</span></div><div class=categories><i class="fa-solid fa-folder" aria-hidden=true></i>
<a href=/categories/jenkins/>Jenkins</a></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/jenkins/>Jenkins</a></span></div></div></header><div class=post-content><p>用了hexo很久， 最近想要不止在自己的电脑上写博客， 每个电脑都能写。 然而hexo不支持， 所以想到了用jenkins配hexo。 当然jenkins可不是专门干这个的， jenkins可还有大用处。 我自己配置的时候遇见了很多坑， 如果遇见了一样的， 可以参考这篇帖子。 希望给你帮助。</p><h2 id=hexo配置>hexo配置
<a class=heading-link href=#hexo%e9%85%8d%e7%bd%ae><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>由于我不太想要把自己的帖子source都暴露在网上， 所以我用了一个private repo。所有就有了如下的配置图</p><h2 id=配置图>配置图
<a class=heading-link href=#%e9%85%8d%e7%bd%ae%e5%9b%be><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><pre tabindex=0><code class=language-配置图 data-lang=配置图>
hexo/source &gt;------
            commit|
                  |------&gt; jenkins
                    -----&lt; hook &amp;&amp; logic
                   |
                   |
hexo/public &lt;-------
             update
</code></pre><h2 id=jenkins配置>jenkins配置
<a class=heading-link href=#jenkins%e9%85%8d%e7%bd%ae><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>我把jenkins放在了aws上面。 之前很久就想要用ec2， 但是总是没有机会。 通过这次机会， 一并用了。我参考了这个<a href=https://d1.awsstatic.com/Projects/P5505030/aws-project_Jenkins-build-server.pdf class=external-link target=_blank rel=noopener>文件</a>
当然， 折腾也开始了。</p><h3 id=host-name-is-not-ec2-user>host name is not ec2-user
<a class=heading-link href=#host-name-is-not-ec2-user><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>不要用ssh去<code>ec2-user@xxxxxx.amazon.com</code>， amazon不会创建ec2-user给你，用要用<code>ubuntu</code>。</p><h3 id=关于-pem-key>关于 .pem key
<a class=heading-link href=#%e5%85%b3%e4%ba%8e-pem-key><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>如果你用的是windows， 很不幸， 一旦文件在window目录下存储过， 那么他的permision就是错的， 你大概会遇到 <code>... permission denied (public key) ...</code> 这种报错。 尝试在linux下打开， 然后用一下命令 <code>sudo chmod 400 &lt;your_pem_key></code>。至于linux环境有很多种解决方法。 我现在用的是windows subsystem for linux (WSL)。</p><h3 id=关于安装jenkins在aws>关于安装jenkins在aws
<a class=heading-link href=#%e5%85%b3%e4%ba%8e%e5%ae%89%e8%a3%85jenkins%e5%9c%a8aws><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>aws ec2就是一个linux环境，如果你安装的环境不是这<a href=https://d1.awsstatic.com/Projects/P5505030/aws-project_Jenkins-build-server.pdf class=external-link target=_blank rel=noopener>文件</a>上的环境， 你可以直接在网上搜索安装方法。 我用的ubuntu， 所以直接按照ubuntu的方法安装了。</p><h3 id=创建-jenkins-job>创建 jenkins job
<a class=heading-link href=#%e5%88%9b%e5%bb%ba-jenkins-job><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><ol><li>创建一个freestyle job</li><li>写一段这个任务的description</li><li>勾选 <code>GitHub project</code>, 填写<code>project url</code>， 但是好像写不写都行。</li><li><code>Source Code Management</code> -> <code>Git</code> -> <code>Repository URL</code>。这里可以填https的clone地址，也可以填ssh的clone地址。我填写的是https的地址。</li><li><code>Credentials</code> 添加github的用户名密码。git的用户名写在<code>Username</code>栏里， git的密码写在<code>Password</code>栏里。 <code>Description</code> 栏里写一些有意义的comments</li><li>勾选 <code>Build Triggers</code> -> <code>GitHub hook trigger for GITScm polling</code></li><li><code>Build</code> -> <code>Execute Shell</code></li></ol><h2 id=创建-webhook>创建 webhook
<a class=heading-link href=#%e5%88%9b%e5%bb%ba-webhook><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>进入存储hexo/source的repo， 选<code>Settings</code> -> <code>Webhooks</code> -> <code>Add Webhooks</code>。</p><p><code>Payload URL</code> 填的是 <code>&lt;jenkins_addr>/github-webhook</code>。 注意slash后面一定要填<strong>github-webhook</strong>。</p><h2 id=execute-shell-内容><code>Execute Shell</code> 内容
<a class=heading-link href=#execute-shell-%e5%86%85%e5%ae%b9><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>这个内容的思路就是一个生成hexo public folder然后push到git上的过程。这个需要一点一点试。以下是我的bash script，仅供参考</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo su ubuntu
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd /home/ubuntu
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rm &lt;hexo_source_repo_folder&gt; -r
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>git clone https://<span style=color:#ff7b72;font-weight:700>{</span>username<span style=color:#ff7b72;font-weight:700>}</span>:<span style=color:#ff7b72;font-weight:700>{</span>password<span style=color:#ff7b72;font-weight:700>}</span>@github.com/&lt;hexo_source_repo&gt;.git
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cp -r &lt;hexo_source_repo_folder&gt;/* &lt;hexo_project_on_ec2&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd &lt;hexo_project_on_ec2&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hexo d -g
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exit
</span></span></code></pre></div><h3 id=为啥要换用户成ubuntu>为啥要换用户成ubuntu
<a class=heading-link href=#%e4%b8%ba%e5%95%a5%e8%a6%81%e6%8d%a2%e7%94%a8%e6%88%b7%e6%88%90ubuntu><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>当jenkins执行scripts的时候会以 user <code>jenkins</code> 执行。这个user是jenkins自动创建的，属于nogroup， 所以执行啥啥都没有权限。 那我就不用这个user。</p><p>另一种方法是把jenkins用户加入root组别里面。</p><h3 id=hexo-g--d-permission-denied>hexo g -d permission denied
<a class=heading-link href=#hexo-g--d-permission-denied><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>本来做到这，我都觉得已经做完了， 谁知道执行<code>hexo g -d</code> 失败！原因是linux管当前user要验证， 但是jenkins可是不会给你手动输入的。 用ssh-keygen生成一个key给ec2 linux， 部署到hexo public repo里面。</p><p>happy blogging~</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
1990 -
2025
130l
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>