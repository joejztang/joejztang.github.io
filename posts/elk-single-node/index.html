<!doctype html><html lang=en><head><title>elk single node · 130l</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="130l"><meta name=description content='
  introduction
  
    
    Link to heading
  


os: ubuntu 14.04
elasticsearch: 2.2.x
logstash: 2.2.x
kibana: 4.5.x

what does it like for ELK stack


client servers installed with filebeat sends logs to elk server
elk/logstash server process and index log, store logs, search and visualize and using nginx to do reverse proxy


  installations
  
    
    Link to heading
  


  install java 8
  
    
    Link to heading
  

sudo add-apt-repository -y ppa:webupd8team/java
sudo apt-get update
sudo apt-get -y install oracle-java8-installer

  install elasticsearch
  
    
    Link to heading
  

wget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
echo "deb http://packages.elastic.co/elasticsearch/2.x/debian stable main" | sudo tee -a /etc/apt/sources.list.d/elasticsearch-2.x.list
sudo apt-get update
sudo apt-get install -y elasticsearch
elasticsearch is installed, now configurations.'><meta name=keywords content="blog,science,technology,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="elk single node"><meta name=twitter:description content='introduction Link to heading os: ubuntu 14.04 elasticsearch: 2.2.x logstash: 2.2.x kibana: 4.5.x what does it like for ELK stack
client servers installed with filebeat sends logs to elk server elk/logstash server process and index log, store logs, search and visualize and using nginx to do reverse proxy installations Link to heading install java 8 Link to heading sudo add-apt-repository -y ppa:webupd8team/java sudo apt-get update sudo apt-get -y install oracle-java8-installer install elasticsearch Link to heading wget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add - echo "deb http://packages.elastic.co/elasticsearch/2.x/debian stable main" | sudo tee -a /etc/apt/sources.list.d/elasticsearch-2.x.list sudo apt-get update sudo apt-get install -y elasticsearch elasticsearch is installed, now configurations.'><meta property="og:url" content="http://www.example.com/posts/elk-single-node/"><meta property="og:site_name" content="130l"><meta property="og:title" content="elk single node"><meta property="og:description" content='introduction Link to heading os: ubuntu 14.04 elasticsearch: 2.2.x logstash: 2.2.x kibana: 4.5.x what does it like for ELK stack
client servers installed with filebeat sends logs to elk server elk/logstash server process and index log, store logs, search and visualize and using nginx to do reverse proxy installations Link to heading install java 8 Link to heading sudo add-apt-repository -y ppa:webupd8team/java sudo apt-get update sudo apt-get -y install oracle-java8-installer install elasticsearch Link to heading wget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add - echo "deb http://packages.elastic.co/elasticsearch/2.x/debian stable main" | sudo tee -a /etc/apt/sources.list.d/elasticsearch-2.x.list sudo apt-get update sudo apt-get install -y elasticsearch elasticsearch is installed, now configurations.'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-06-10T17:19:40+00:00"><meta property="article:modified_time" content="2019-06-10T17:19:40+00:00"><meta property="article:tag" content="Elk"><link rel=canonical href=http://www.example.com/posts/elk-single-node/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.4b392a85107b91dbdabc528edf014a6ab1a30cd44cafcd5325c8efe796794fca.css integrity="sha256-SzkqhRB7kdvavFKO3wFKarGjDNRMr81TJcjv55Z5T8o=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/img/favicon.svg sizes=any><link rel=icon type=image/png href=/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/img/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=http://www.example.com/>130l
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Posts</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=http://www.example.com/posts/elk-single-node/>elk single node</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2019-06-10T17:19:40Z>June 10, 2019
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
5-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/elk/>Elk</a></span></div></div></header><div class=post-content><h2 id=introduction>introduction
<a class=heading-link href=#introduction><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>os: ubuntu 14.04</li><li>elasticsearch: 2.2.x</li><li>logstash: 2.2.x</li><li>kibana: 4.5.x</li></ul><p>what does it like for ELK stack</p><p><img src=/images/elk.png alt=elk></p><ul><li>client servers installed with filebeat sends logs to elk server</li><li>elk/logstash server process and index log, store logs, search and visualize and using nginx to do reverse proxy</li></ul><h2 id=installations>installations
<a class=heading-link href=#installations><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><h3 id=install-java-8>install java 8
<a class=heading-link href=#install-java-8><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo add-apt-repository -y ppa:webupd8team/java
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get -y install oracle-java8-installer
</span></span></code></pre></div><h3 id=install-elasticsearch>install elasticsearch
<a class=heading-link href=#install-elasticsearch><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
</span></span><span style=display:flex><span>echo <span style=color:#a5d6ff>&#34;deb http://packages.elastic.co/elasticsearch/2.x/debian stable main&#34;</span> | sudo tee -a /etc/apt/sources.list.d/elasticsearch-2.x.list
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install -y elasticsearch
</span></span></code></pre></div><p>elasticsearch is installed, now configurations.</p><p><code>sudo vim /etc/elasticsearch/elasticsearch.yml</code></p><p>this is where to configure elasticsearch. we care about who can access elasticsearch. in order to keep it safe, we only allow <code>localhost</code> to access elasticsearch so that outsider cannot access elasticsearch instance, hence the data.</p><p>to do this, find <code>network.host</code> keyword, uncomment the line:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span>...
</span></span><span style=display:flex><span>  network.host: localhost
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>save and exit</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo service elasticsearch restart
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># start elasticsearch when boot up and priority of starting and killing</span>
</span></span><span style=display:flex><span>sudo update-rc.d elasticsearch defaults <span style=color:#a5d6ff>95</span> <span style=color:#a5d6ff>10</span>
</span></span><span style=display:flex><span><span style=color:#a5d6ff>``</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>### install kibana</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a5d6ff>```</span>bash
</span></span><span style=display:flex><span>echo <span style=color:#a5d6ff>&#34;deb http://packages.elastic.co/kibana/4.5/debian stable main&#34;</span> | sudo tee -a /etc/apt/sources.list.d/kibana-4.5.x.list
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get -y install kibana
</span></span></code></pre></div><p>next, like elasticsearch, we need to configure kibana</p><p>open config file</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /opt/kibana/config/kibana.yml
</span></span></code></pre></div><p>find <code>server.host</code> keyword and replace <code>0.0.0.0</code> into <code>localhost</code></p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span>server.host: <span style=color:#a5d6ff>&#34;localhost&#34;</span>
</span></span></code></pre></div><p>save and exit</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo update-rc.d kibana defaults <span style=color:#a5d6ff>96</span> <span style=color:#a5d6ff>9</span>
</span></span><span style=display:flex><span>sudo service kibana start
</span></span></code></pre></div><h3 id=install-nginx>install nginx
<a class=heading-link href=#install-nginx><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get install nginx apache2-utils
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># create admin user named &#34;kibanaadmin&#34;, that can access kibana web interface</span>
</span></span><span style=display:flex><span>sudo htpasswd -c /etc/nginx/htpasswd.users kibanaadmin
</span></span></code></pre></div><p>now configure nginx</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/nginx/sites-available/default
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span>server {
</span></span><span style=display:flex><span>    listen <span style=color:#a5d6ff>80</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    server_name localhost;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    auth_basic <span style=color:#a5d6ff>&#34;Restricted Access&#34;</span>;
</span></span><span style=display:flex><span>    auth_basic_user_file <span style=color:#79c0ff>/etc/</span>nginx/htpasswd.users;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    location / {
</span></span><span style=display:flex><span>        proxy_pass http:<span style=color:#79c0ff>//</span>localhost:<span style=color:#a5d6ff>5601</span>;
</span></span><span style=display:flex><span>        proxy_http_version <span style=color:#a5d6ff>1</span>.<span style=color:#a5d6ff>1</span>;
</span></span><span style=display:flex><span>        proxy_set_header Upgrade $http_upgrade;
</span></span><span style=display:flex><span>        proxy_set_header Connection <span style=color:#a5d6ff>&#39;upgrade&#39;</span>;
</span></span><span style=display:flex><span>        proxy_set_header Host $host;
</span></span><span style=display:flex><span>        proxy_cache_bypass $http_upgrade;        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><em>optional</em>: in case you meet <code>fail to bind</code> error, please follow <a href=https://joejztang.github.io/2019/06/06/nginx-bind-to-fails/ class=external-link target=_blank rel=noopener>this</a></p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo service nginx restart
</span></span></code></pre></div><p>now if you go to localhost, then you will see kibana welcome page.</p><h3 id=install-logstash>install logstash
<a class=heading-link href=#install-logstash><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#a5d6ff>&#39;deb http://packages.elastic.co/logstash/2.2/debian stable main&#39;</span> | sudo tee /etc/apt/sources.list.d/logstash-2.2.x.list
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install logstash
</span></span></code></pre></div><h3 id=generating-ssl-certificates>generating SSL certificates
<a class=heading-link href=#generating-ssl-certificates><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><blockquote><p>Since we are going to use Filebeat to ship logs from our Client Servers to our ELK Server, we need to create an SSL certificate and key pair. The certificate is used by Filebeat to verify the identity of ELK Server. Create the directories that will store the certificate and private key with the following commands:</p></blockquote><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkdir -p /etc/pki/tls/certs
</span></span><span style=display:flex><span>sudo mkdir /etc/pki/tls/private
</span></span></code></pre></div><blockquote><p>Now you have two options for generating your SSL certificates. If you have a DNS setup that will allow your client servers to resolve the IP address of the ELK Server, use Option 2. Otherwise, Option 1 will allow you to use IP addresses.</p></blockquote><p><strong>this post will only introduce option 1, that is using ip address</strong></p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vi /etc/ssl/openssl.cnf
</span></span></code></pre></div><p>find <code>[v3_ca]</code> section and add one line below</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span>...
</span></span><span style=display:flex><span>subjectAltName = IP: ELK_server_private_IP
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>save and exit</p><p><strong>hint:</strong> how to find elk server private ip address</p><p><code>ifconfig eth0 | grep "inet addr:" | cut -d ":" -f2 | cut -d " " -f1</code></p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># generate ssl certificate in appropriate locations (/etc/pki/tls/)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd /etc/pki/tls
</span></span><span style=display:flex><span>sudo openssl req -config /etc/ssl/openssl.cnf -x509 -days <span style=color:#a5d6ff>3650</span> -batch -nodes -newkey rsa:2048 -keyout private/logstash-forwarder.key -out certs/logstash-forwarder.crt
</span></span></code></pre></div><h3 id=configure-logstash>configure logstash
<a class=heading-link href=#configure-logstash><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><blockquote><p>Logstash configuration files are in the JSON-format, and reside in /etc/logstash/conf.d. The configuration consists of three sections: <strong>inputs, filters, and outputs</strong>.</p></blockquote><p>create input conf by</p><p><code>sudo vim /etc/logstash/conf.d/02-beats-input.conf</code></p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span>input {
</span></span><span style=display:flex><span>  beats {
</span></span><span style=display:flex><span>    port =&gt; <span style=color:#a5d6ff>5044</span>
</span></span><span style=display:flex><span>    ssl =&gt; true
</span></span><span style=display:flex><span>    ssl_certificate =&gt; <span style=color:#a5d6ff>&#34;/etc/pki/tls/certs/logstash-forwarder.crt&#34;</span>
</span></span><span style=display:flex><span>    ssl_key =&gt; <span style=color:#a5d6ff>&#34;/etc/pki/tls/private/logstash-forwarder.key&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>create filter conf by</p><p><code>sudo vim /etc/logstash/conf.d/10-syslog-filter.conf</code></p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span>filter {
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>if</span> [type] == <span style=color:#a5d6ff>&#34;syslog&#34;</span> {
</span></span><span style=display:flex><span>    grok {
</span></span><span style=display:flex><span>      match =&gt; { <span style=color:#a5d6ff>&#34;message&#34;</span> =&gt; <span style=color:#a5d6ff>&#34;%{SYSLOGTIMESTAMP:syslog_timestamp} %{SYSLOGHOST:syslog_hostname} %{DATA:syslog_program}(?:\[%{POSINT:syslog_pid}\])?: %{GREEDYDATA:syslog_message}&#34;</span> }
</span></span><span style=display:flex><span>      add_field =&gt; [ <span style=color:#a5d6ff>&#34;received_at&#34;</span>, <span style=color:#a5d6ff>&#34;%{@timestamp}&#34;</span> ]
</span></span><span style=display:flex><span>      add_field =&gt; [ <span style=color:#a5d6ff>&#34;received_from&#34;</span>, <span style=color:#a5d6ff>&#34;%{host}&#34;</span> ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    syslog_pri { }
</span></span><span style=display:flex><span>    date {
</span></span><span style=display:flex><span>      match =&gt; [ <span style=color:#a5d6ff>&#34;syslog_timestamp&#34;</span>, <span style=color:#a5d6ff>&#34;MMM  d HH:mm:ss&#34;</span>, <span style=color:#a5d6ff>&#34;MMM dd HH:mm:ss&#34;</span> ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>create output conf by</p><p><code>sudo vim /etc/logstash/conf.d/30-elasticsearch-output.conf</code></p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span>    output {
</span></span><span style=display:flex><span>      elasticsearch {
</span></span><span style=display:flex><span>        hosts =&gt; [<span style=color:#a5d6ff>&#34;localhost:9200&#34;</span>]
</span></span><span style=display:flex><span>        sniffing =&gt; true
</span></span><span style=display:flex><span>        manage_template =&gt; false
</span></span><span style=display:flex><span>        index =&gt; <span style=color:#a5d6ff>&#34;%{[@metadata][beat]}-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style=display:flex><span>        document_type =&gt; <span style=color:#a5d6ff>&#34;%{[@metadata][type]}&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>the way to check logstash configuration is</p><p><code>sudo service logstash configtest</code></p><p>if you see <code>Configuration OK</code>, it means there is no syntax error</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo service logstash restart
</span></span><span style=display:flex><span>sudo update-rc.d logstash defaults <span style=color:#a5d6ff>96</span> <span style=color:#a5d6ff>9</span>
</span></span></code></pre></div><h3 id=optional-load-kibana-dashboards><em>(optional)</em> load kibana dashboards
<a class=heading-link href=#optional-load-kibana-dashboards><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><blockquote><p>Elastic provides several sample Kibana dashboards and Beats index patterns that can help you get started with Kibana</p></blockquote><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd ~
</span></span><span style=display:flex><span>curl -L -O https://download.elastic.co/beats/dashboards/beats-dashboards-1.1.0.zip
</span></span><span style=display:flex><span>sudo apt-get -y install unzip
</span></span><span style=display:flex><span>unzip beats-dashboards-*.zip
</span></span><span style=display:flex><span>cd beats-dashboards-*
</span></span><span style=display:flex><span>./load.sh
</span></span></code></pre></div><p>we can see some index pattern we just loaded</p><ul><li>[packetbeat-]YYYY.MM.DD</li><li>[topbeat-]YYYY.MM.DD</li><li>[filebeat-]YYYY.MM.DD</li><li>[winlogbeat-]YYYY.MM.DD</li></ul><h3 id=optional-load-filebeat-index-template-in-elasticsearch><em>(optional)</em> load filebeat index template in elasticsearch
<a class=heading-link href=#optional-load-filebeat-index-template-in-elasticsearch><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><h3 id=optional-copy-elk-cert-to-client-server><em>(optional)</em> copy elk cert to client server
<a class=heading-link href=#optional-copy-elk-cert-to-client-server><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>copy elk cert to client server in order to establish communication. because our model is single node, this is not mandatory.</p><h3 id=install-filebeat-on-client-server>install filebeat on client server
<a class=heading-link href=#install-filebeat-on-client-server><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p><strong>notice that it must happen at client server</strong></p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#a5d6ff>&#34;deb https://packages.elastic.co/beats/apt stable main&#34;</span> |  sudo tee -a /etc/apt/sources.list.d/beats.list
</span></span><span style=display:flex><span>wget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install filebeat
</span></span></code></pre></div><p>next we configure filebeat</p><p><code>sudo vim /etc/filebeat/filebeat.yml</code></p><p>near top of the file, we will find <code>prospectors</code> section. what we do following is to send only <code>syslog</code> and <code>auth.log</code> to logstash</p><p>we do the following</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span>...
</span></span><span style=display:flex><span>      paths:
</span></span><span style=display:flex><span>        - <span style=color:#79c0ff>/var/</span>log/auth.log
</span></span><span style=display:flex><span>        - <span style=color:#79c0ff>/var/</span>log/syslog
</span></span><span style=display:flex><span>#        - <span style=color:#79c0ff>/var/</span>log/*.log
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>      document_type: syslog
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>### Logstash as output
</span></span><span style=display:flex><span>  logstash:
</span></span><span style=display:flex><span>    # The Logstash hosts
</span></span><span style=display:flex><span>    hosts: [<span style=color:#a5d6ff>&#34;ELK_server_private_IP:5044&#34;</span>]
</span></span><span style=display:flex><span># directly under hosts section we add
</span></span><span style=display:flex><span>    bulk_max_size: <span style=color:#a5d6ff>1024</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>    tls:
</span></span><span style=display:flex><span>      # List of root certificates for HTTPS server verifications
</span></span><span style=display:flex><span>      certificate_authorities: [<span style=color:#a5d6ff>&#34;/etc/pki/tls/certs/logstash-forwarder.crt&#34;</span>]
</span></span></code></pre></div><p>save and exit</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo service filebeat restart
</span></span><span style=display:flex><span>sudo update-rc.d filebeat defaults <span style=color:#a5d6ff>95</span> <span style=color:#a5d6ff>10</span>
</span></span></code></pre></div><h2 id=test-filebeat-installation>test filebeat installation
<a class=heading-link href=#test-filebeat-installation><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>on <strong>elk server</strong>, we verify if we receive data by searching filebeat.</p><p><code>curl -XGET 'http://localhost:9200/filebeat-*/_search?pretty'</code></p><blockquote><p>If your output shows <strong>0</strong> total hits, Elasticsearch is not loading any logs under the index you searched for, and you should review your setup for errors.</p></blockquote><h2 id=go-to-kibana-dashboard>go to kibana dashboard
<a class=heading-link href=#go-to-kibana-dashboard><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>if the first time you go to kibana dashboard, it asked you to select a default index pattern. after your selection, and <strong>star</strong> it, go to <code>Discover</code>, and you find your log.</p><h2 id=credit-to>credit to
<a class=heading-link href=#credit-to><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li><a href=https://www.digitalocean.com/community/tutorials/how-to-install-elasticsearch-logstash-and-kibana-elk-stack-on-ubuntu-14-04 class=external-link target=_blank rel=noopener>elk on ubuntu</a></li><li><a href=https://anandprakashtandale.wordpress.com/2016/06/28/elk-elastic-search-logstash-kibanastack-installation-script/ class=external-link target=_blank rel=noopener>elk installation script</a></li></ul></div><footer></footer></article></section></div><footer class=footer><section class=container>©
1990 -
2025
130l
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>