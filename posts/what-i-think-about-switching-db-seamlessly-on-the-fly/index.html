<!doctype html><html lang=en><head><title>what i think about switching db seamlessly on the fly · 130l</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="130l"><meta name=description content="
  problem description
  
    
    Link to heading
  

it is pretty simple I guess. I have an application which read data from a mongodb. every sunday I will just simply flush the db and update it using an updater.
by doing so, I introduce 3 hours down time/inconsistency time. I want to minimize it.

  what I researched
  
    
    Link to heading
  


  mongodb replication
  
    
    Link to heading
  

in general, db repliaction is the process of storing data in more than one site or node. by doing so it improves the availability of data. at the same time, it also raises the problem of how to maintain consistency of data. it related to distributed system though."><meta name=keywords content="blog,science,technology,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="what i think about switching db seamlessly on the fly"><meta name=twitter:description content="problem description Link to heading it is pretty simple I guess. I have an application which read data from a mongodb. every sunday I will just simply flush the db and update it using an updater. by doing so, I introduce 3 hours down time/inconsistency time. I want to minimize it.
what I researched Link to heading mongodb replication Link to heading in general, db repliaction is the process of storing data in more than one site or node. by doing so it improves the availability of data. at the same time, it also raises the problem of how to maintain consistency of data. it related to distributed system though."><meta property="og:url" content="http://www.example.com/posts/what-i-think-about-switching-db-seamlessly-on-the-fly/"><meta property="og:site_name" content="130l"><meta property="og:title" content="what i think about switching db seamlessly on the fly"><meta property="og:description" content="problem description Link to heading it is pretty simple I guess. I have an application which read data from a mongodb. every sunday I will just simply flush the db and update it using an updater. by doing so, I introduce 3 hours down time/inconsistency time. I want to minimize it.
what I researched Link to heading mongodb replication Link to heading in general, db repliaction is the process of storing data in more than one site or node. by doing so it improves the availability of data. at the same time, it also raises the problem of how to maintain consistency of data. it related to distributed system though."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-05-03T10:36:15+00:00"><meta property="article:modified_time" content="2019-05-03T10:36:15+00:00"><meta property="article:tag" content="Idea"><meta property="article:tag" content="Whim"><link rel=canonical href=http://www.example.com/posts/what-i-think-about-switching-db-seamlessly-on-the-fly/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.4b392a85107b91dbdabc528edf014a6ab1a30cd44cafcd5325c8efe796794fca.css integrity="sha256-SzkqhRB7kdvavFKO3wFKarGjDNRMr81TJcjv55Z5T8o=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/img/favicon.svg sizes=any><link rel=icon type=image/png href=/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/img/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=http://www.example.com/>130l
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Posts</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=http://www.example.com/posts/what-i-think-about-switching-db-seamlessly-on-the-fly/>what i think about switching db seamlessly on the fly</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2019-05-03T10:36:15Z>May 3, 2019
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
3-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/idea/>Idea</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/whim/>Whim</a></span></div></div></header><div class=post-content><h2 id=problem-description>problem description
<a class=heading-link href=#problem-description><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>it is pretty simple I guess. I have an application which read data from a mongodb. every sunday I will just simply flush the db and update it using an updater.
by doing so, I introduce 3 hours down time/inconsistency time. I want to minimize it.</p><h2 id=what-i-researched>what I researched
<a class=heading-link href=#what-i-researched><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><h3 id=mongodb-replication>mongodb replication
<a class=heading-link href=#mongodb-replication><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>in general, db repliaction is the process of storing data in more than one site or node. by doing so it improves the availability of data. at the same time, it also raises the problem of how to maintain consistency of data. it related to distributed system though.</p><p>advantage of replication is obvious. it</p><ul><li>increasing availability of data</li><li>increasing data reliability</li><li>user using different copy/replica of data to give high performance</li></ul><p>also there are disadvantages.</p><ul><li>more space</li><li>expensive updating accross all nodes</li><li>maintaining data consistency ask for efforts</li></ul><p>there are many types of data replication.</p><ol><li>transactional repliaction: transactional consistency is guaranteed. typically used in server-to-server environments. it reflects every changes.</li><li>snapshot replication: snapshot replication is generally used when data change is not so frequent.</li><li>merge replication: merge replication is the most complex type of repliaction. it usually used in server-to-client environment.</li></ol><p>replication schemes are:</p><ol><li>full replication. every node has the same full replication.</li><li>no replication. every node has its unique data.</li><li>partial replication.</li></ol><p>for mongodb, if one want to replicate db, first has to stop, and then give directions in commad line. one can refer to documentation or tutorial online.</p><h3 id=db-sharding-related-but-not-a-solution-for-this-problem>db sharding (related but not a solution for this problem)
<a class=heading-link href=#db-sharding-related-but-not-a-solution-for-this-problem><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>sharding data in plain English is chopping data into pieces and store into different databases. by doing so, it will solve</p><ul><li>outrage of a db by decreasing data size on each db</li><li>increasing performance</li></ul><p>first one has a logical shards. it is how data shards according to some rule. it could be as easy as mod or more complicated as location.</p><p>after we have logical shards, we send logical shards to physical shards. physical shards may have less number than logical shards.</p><p>logical shards is similar to the concept of virtual memory whereas physical shards is similar with physical memory.</p><h3 id=current-solution-microservice-design>current solution: microservice design
<a class=heading-link href=#current-solution-microservice-design><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>I think designing as microservice is the key to this problem.</p><p>so basically what I thought is having two mongodb, one is called primary and the other one is called backupdate. one gateway instance running I call it listener to listen to updater.</p><p>the working logic is that once updater is finished, it sends a signal to listener. listener will switch db from one to the other and rename the current one to primary and the other backupdate.</p><p>it finally restart app that consumes the mongodb. done.</p><h2 id=credit-to>credit to
<a class=heading-link href=#credit-to><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li><a href=https://www.geeksforgeeks.org/dbms-data-replication/ class=external-link target=_blank rel=noopener>DBMS | Date Replication</a></li><li><a href=https://www.citusdata.com/blog/2018/01/10/sharding-in-plain-english/ class=external-link target=_blank rel=noopener>database sharding explained in plain English</a></li><li><a href=https://labs.spotify.com/2015/06/23/user-database-switch/ class=external-link target=_blank rel=noopener>switching user database on a running system</a></li><li><a href=http://www.craigkerstiens.com/2012/11/30/sharding-your-database/ class=external-link target=_blank rel=noopener>sharding your database</a></li></ul></div><footer></footer></article></section></div><footer class=footer><section class=container>©
1990 -
2025
130l
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>